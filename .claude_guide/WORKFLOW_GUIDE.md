# üéØ Gu√≠a de Workflow con Claude Code

Esta gu√≠a documenta c√≥mo trabajo yo (Claude) de forma √≥ptima con este proyecto para aprovechar al m√°ximo el sistema de agentes.

## üìã Regla de Oro: SIEMPRE usar TodoWrite

**OBLIGATORIO**: Antes de empezar cualquier tarea, debo crear una lista de todos con `TodoWrite`.

### Por qu√© es obligatorio:

1. ‚úÖ **Visibilidad**: El usuario ve exactamente qu√© har√©
2. ‚úÖ **Trazabilidad**: Se puede seguir el progreso en tiempo real
3. ‚úÖ **Organizaci√≥n**: Evita olvidar pasos importantes
4. ‚úÖ **Calidad**: Fuerza a pensar antes de actuar

### Ejemplo CORRECTO:

```
Usuario: "Implementa autenticaci√≥n con Google"

Yo:
> Voy a usar TodoWrite para planificar esta tarea

TodoWrite:
1. Investigar requisitos de Firebase Auth con Google (pending)
2. Configurar Google OAuth en Firebase Console (pending)
3. Implementar componente de login con Google (pending)
4. Crear servicio de autenticaci√≥n (pending)
5. Agregar tests para auth service (pending)
6. Revisar seguridad con security-auditor (pending)
7. Documentar el flujo de autenticaci√≥n (pending)

> Ahora comenzar√© con el primer todo...
```

### Ejemplo INCORRECTO ‚ùå:

```
Usuario: "Implementa autenticaci√≥n con Google"

Yo: "Voy a implementar la autenticaci√≥n..."
[Empieza a codificar sin planificar]
```

## üöÄ Workflow General (Mi Proceso Est√°ndar)

### 1Ô∏è‚É£ RECIBIR TAREA DEL USUARIO

```
Usuario: "Necesito implementar pagos con Stripe"
```

### 2Ô∏è‚É£ CREAR TODOS INMEDIATAMENTE

```markdown
**Yo respondo:**

Perfecto, voy a planificar la implementaci√≥n de pagos con Stripe.

[Uso TodoWrite para crear lista completa de tareas]

Todos creados:
1. ‚úÖ Analizar requisitos con requirements-analyst
2. ‚è≥ Dise√±ar arquitectura de pagos con firebase-architect
3. ‚è≥ Configurar Stripe en Firebase proyecto
4. ‚è≥ Implementar Cloud Function createPaymentIntent
5. ‚è≥ Implementar Cloud Function stripeWebhook
6. ‚è≥ Crear componente de pago en React
7. ‚è≥ Agregar tests con test-writer
8. ‚è≥ Auditar seguridad con security-auditor
9. ‚è≥ Testear flujo completo con /test-payment-flow
10. ‚è≥ Documentar API de pagos

Comenzar√© con el primer todo: an√°lisis de requisitos.
```

### 3Ô∏è‚É£ EJECUTAR CADA TODO SECUENCIALMENTE

#### Todo 1: Analizar requisitos

```markdown
**Marcando todo 1 como in_progress**

> Use the requirements-analyst agent to analyze payment requirements

[Agent analiza y responde]

**Marcando todo 1 como completed**
**Marcando todo 2 como in_progress**
```

#### Todo 2: Dise√±ar arquitectura

```markdown
> Use the firebase-architect agent to design the payment flow architecture

[Agent dise√±a arquitectura]

**Marcando todo 2 como completed**
**Marcando todo 3 como in_progress**
```

### 4Ô∏è‚É£ ACTUALIZAR TODOS EN TIEMPO REAL

- ‚úÖ Marcar como `completed` inmediatamente al terminar
- ‚è≥ Marcar como `in_progress` antes de empezar
- üîÑ Agregar nuevos todos si se descubren tareas adicionales
- üóëÔ∏è Eliminar todos que ya no sean relevantes

### 5Ô∏è‚É£ AL FINALIZAR

```markdown
‚úÖ **Todos completados (10/10)**

Resumen de lo implementado:
- Pagos con Stripe configurados
- Cloud Functions creadas y testeadas
- UI de pago implementada
- Seguridad auditada
- Documentaci√≥n completa

**Comandos √∫tiles:**
- `/test-payment-flow` para testear
- `/security-audit` antes de producci√≥n
- `/deploy-staging` para desplegar a staging
```

## üé≠ Orquestaci√≥n de Agentes (Mi Estrategia)

### Cu√°ndo usar cada agente:

#### üé® PLANIFICACI√ìN

**requirements-analyst**
- ‚úÖ Al inicio de cualquier feature nueva
- ‚úÖ Cuando el usuario pide algo vago/ambiguo
- ‚úÖ Para crear user stories y acceptance criteria

```
> Use the requirements-analyst agent to analyze and document the user authentication requirements
```

**firebase-architect**
- ‚úÖ Despu√©s del an√°lisis de requisitos
- ‚úÖ Para dise√±ar data models de Firestore
- ‚úÖ Para planificar Cloud Functions
- ‚úÖ Al refactorizar arquitectura

```
> Use the firebase-architect agent to design the Firestore data model for user profiles and subscriptions
```

**tech-researcher**
- ‚úÖ Cuando necesito evaluar librer√≠as
- ‚úÖ Para buscar mejores pr√°cticas
- ‚úÖ Al decidir entre m√∫ltiples opciones t√©cnicas

```
> Use the tech-researcher agent to compare state management libraries for this React app
```

#### üíª DESARROLLO

**code-reviewer**
- ‚úÖ SIEMPRE despu√©s de implementar c√≥digo
- ‚úÖ Antes de hacer commits importantes
- ‚úÖ Antes de merge a main/master
- ‚úÖ OBLIGATORIO para c√≥digo de pagos

```
> Use the code-reviewer agent to review my payment implementation in functions/src/payments.ts
```

**test-writer**
- ‚úÖ Despu√©s de implementar l√≥gica de negocio
- ‚úÖ Para Cloud Functions (especialmente pagos)
- ‚úÖ Cuando se necesita aumentar coverage

```
> Use the test-writer agent to create comprehensive tests for the authentication service
```

**cloud-functions-specialist**
- ‚úÖ Para implementar Cloud Functions
- ‚úÖ SIEMPRE para pagos con Stripe
- ‚úÖ Para webhooks y triggers de Firestore

```
> Use the cloud-functions-specialist agent to implement the Stripe webhook handler with signature verification
```

#### üß™ TESTING & QA

**qa-specialist**
- ‚úÖ Antes de cada release
- ‚úÖ Para crear test plans
- ‚úÖ Al recibir bug reports del usuario
- ‚úÖ Para testing manual de features cr√≠ticas

```
> Use the qa-specialist agent to create a comprehensive test plan for the payment flow
```

**security-auditor**
- ‚úÖ OBLIGATORIO antes de producci√≥n
- ‚úÖ SIEMPRE para features de pagos
- ‚úÖ Despu√©s de cambios en security rules
- ‚úÖ Peri√≥dicamente (cada 2-3 features)

```
> Use the security-auditor agent to perform a complete security audit focusing on the payment flow and Firestore security rules
```

#### üöÄ DEPLOYMENT

**firebase-deployer**
- ‚úÖ Al configurar CI/CD
- ‚úÖ Para deployment strategies
- ‚úÖ Cuando hay problemas de deployment

```
> Use the firebase-deployer agent to set up GitHub Actions CI/CD for automated deployments
```

**documentation-writer**
- ‚úÖ Al finalizar features importantes
- ‚úÖ Para crear API documentation
- ‚úÖ Para user guides
- ‚úÖ Al preparar releases

```
> Use the documentation-writer agent to create API documentation for all Cloud Functions
```

## üìä Workflows por Tipo de Tarea

### üÜï Feature Nueva (Ejemplo: Sistema de Notificaciones)

```markdown
**TodoWrite:**
1. Analizar requisitos (requirements-analyst)
2. Dise√±ar arquitectura (firebase-architect)
3. Investigar librer√≠as de push notifications (tech-researcher)
4. Implementar Cloud Function para env√≠o
5. Implementar UI para gestionar notificaciones
6. Configurar Capacitor push notifications plugin
7. Crear tests (test-writer)
8. Revisar c√≥digo (code-reviewer)
9. Revisar seguridad (security-auditor)
10. Documentar API (documentation-writer)
11. Testear en dispositivos reales (qa-specialist)
12. Deploy a staging (/deploy-staging)
13. Deploy a producci√≥n (/deploy-production)
```

**Ejecuci√≥n paso a paso:**

```
[Todo 1] > Use requirements-analyst agent to document notification requirements
[Todo 2] > Use firebase-architect agent to design notification system architecture
[Todo 3] > Use tech-researcher agent to compare push notification libraries
[Todos 4-6] Implementar c√≥digo...
[Todo 7] > Use test-writer agent to create tests for notification service
[Todo 8] > Use code-reviewer agent to review implementation
[Todo 9] > Use security-auditor agent to audit notification security
[Todo 10] > Use documentation-writer agent to document notification API
[Todo 11] > Use qa-specialist agent to create test plan for notifications
[Todo 12] > /deploy-staging
[Todo 13] > /deploy-production
```

### üêõ Bug Fix (Ejemplo: Payment failing on iOS)

```markdown
**TodoWrite:**
1. Reproducir el bug (qa-specialist para pasos)
2. Analizar logs de Cloud Functions
3. Identificar causa ra√≠z
4. Implementar fix
5. Crear test para prevenir regresi√≥n (test-writer)
6. Revisar fix (code-reviewer)
7. Testear en iOS device
8. Deploy hotfix a producci√≥n
```

### üîÑ Refactoring (Ejemplo: Optimizar Firestore queries)

```markdown
**TodoWrite:**
1. Analizar queries actuales y performance
2. Dise√±ar nueva estructura (firebase-architect)
3. Planificar migraci√≥n de datos
4. Implementar nuevas queries
5. Crear tests (test-writer)
6. Revisar c√≥digo (code-reviewer)
7. Testear performance en emulators
8. Deploy gradual a producci√≥n
```

### üí≥ Feature de Pagos (CR√çTICA - proceso especial)

```markdown
**TodoWrite:**
1. ‚ö†Ô∏è  Analizar requisitos de pago (requirements-analyst)
2. ‚ö†Ô∏è  Dise√±ar flujo seguro (firebase-architect)
3. ‚ö†Ô∏è  Implementar createPaymentIntent function
4. ‚ö†Ô∏è  Implementar webhook handler
5. ‚ö†Ô∏è  Implementar UI de pago
6. ‚ö†Ô∏è  Tests exhaustivos (test-writer)
7. ‚ö†Ô∏è  AUDITOR√çA DE SEGURIDAD OBLIGATORIA (security-auditor)
8. ‚ö†Ô∏è  Test con todas las tarjetas de prueba (/test-payment-flow)
9. ‚ö†Ô∏è  Revisar c√≥digo l√≠nea por l√≠nea (code-reviewer)
10. ‚ö†Ô∏è Testear webhooks en staging
11. ‚ö†Ô∏è Documentar (documentation-writer)
12. ‚ö†Ô∏è Deploy a staging y testear 48 horas
13. ‚ö†Ô∏è Segunda auditor√≠a de seguridad
14. ‚ö†Ô∏è Deploy a producci√≥n con monitoring intensivo
```

**REGLA ESPECIAL PARA PAGOS:**
- ‚úÖ NUNCA saltarse el security-auditor
- ‚úÖ SIEMPRE testear con /test-payment-flow
- ‚úÖ SIEMPRE desplegar a staging primero
- ‚úÖ DOBLE revisi√≥n de c√≥digo

## üéØ Comandos Slash: Cu√°ndo usarlos

### `/deploy-staging`
**Usar cuando:**
- ‚úÖ Feature completa y lista para testing
- ‚úÖ Despu√©s de pasar todos los tests locales
- ‚úÖ Antes de deploy a producci√≥n (SIEMPRE)

**Mi workflow:**
```
1. TodoWrite: marcar todo "Deploy to staging"
2. Ejecutar: /deploy-staging
3. Monitorear logs
4. Testear manualmente
5. TodoWrite: marcar como completed
```

### `/deploy-production`
**Usar cuando:**
- ‚úÖ Staging testeado por al menos 24h
- ‚úÖ Security audit completado
- ‚úÖ Todos los tests passing
- ‚úÖ Documentaci√≥n actualizada

**Mi workflow:**
```
1. TodoWrite: "Deploy to production" (√∫ltimo todo)
2. Verificar todos los checks pasaron
3. Ejecutar: /deploy-production
4. Monitorear por 15-30 minutos
5. Verificar analytics no muestran errores
6. TodoWrite: marcar como completed
```

### `/test-payment-flow`
**Usar cuando:**
- ‚úÖ Implementando nueva feature de pagos
- ‚úÖ Modificando c√≥digo de pagos existente
- ‚úÖ Antes de cada deploy (staging y prod)
- ‚úÖ Peri√≥dicamente para regression testing

### `/security-audit`
**Usar cuando:**
- ‚úÖ Antes de cada deploy a producci√≥n
- ‚úÖ Despu√©s de cambios en security rules
- ‚úÖ Despu√©s de implementar pagos
- ‚úÖ Despu√©s de agregar nueva Cloud Function
- ‚úÖ Peri√≥dicamente (semanal/mensual)

### `/build-mobile`
**Usar cuando:**
- ‚úÖ Listo para release a App Store / Play Store
- ‚úÖ Necesitas testear en dispositivo real
- ‚úÖ Preparando beta builds

## üì± Ejemplo Completo: Feature de Inicio a Fin

**Tarea del usuario:** "Quiero implementar un sistema de comentarios en los posts"

### Mi respuesta completa:

```markdown
Perfecto, voy a implementar el sistema de comentarios. Primero, d√©jame planificar todas las tareas necesarias.

**PLANIFICACI√ìN (TodoWrite):**

1. ‚è≥ Analizar requisitos del sistema de comentarios (requirements-analyst)
2. ‚è≥ Dise√±ar data model de Firestore (firebase-architect)
3. ‚è≥ Dise√±ar security rules para comentarios (firebase-architect)
4. ‚è≥ Implementar Cloud Function para crear comentarios
5. ‚è≥ Implementar Cloud Function para moderaci√≥n (opcional)
6. ‚è≥ Crear componente CommentList en React
7. ‚è≥ Crear componente CommentForm en React
8. ‚è≥ Implementar real-time updates de comentarios
9. ‚è≥ Agregar paginaci√≥n para comentarios
10. ‚è≥ Crear tests unitarios (test-writer)
11. ‚è≥ Crear tests de integraci√≥n (test-writer)
12. ‚è≥ Revisar c√≥digo (code-reviewer)
13. ‚è≥ Revisar seguridad (security-auditor)
14. ‚è≥ Crear test plan manual (qa-specialist)
15. ‚è≥ Documentar API (documentation-writer)
16. ‚è≥ Deploy a staging (/deploy-staging)
17. ‚è≥ Testing en staging
18. ‚è≥ Deploy a producci√≥n (/deploy-production)

---

**EJECUCI√ìN:**

**[Todo 1 - IN PROGRESS]** Analizando requisitos...

> Use the requirements-analyst agent to analyze and document the commenting system requirements including:
> - User authentication requirements
> - Comment structure (text, attachments, mentions)
> - Moderation needs
> - Real-time vs polling
> - Pagination requirements
> - Edit/delete permissions

[Agent responde con an√°lisis detallado]

**[Todo 1 - COMPLETED]**
**[Todo 2 - IN PROGRESS]** Dise√±ando data model...

> Use the firebase-architect agent to design the Firestore data model for comments including:
> - Collection structure (posts/{postId}/comments vs top-level comments collection)
> - Document schema
> - Indexes needed
> - Security rules design
> - Scalability considerations

[Agent dise√±a arquitectura]

Arquitectura propuesta:
```javascript
comments/{commentId}
  - postId: string (indexed)
  - userId: string (indexed)
  - text: string
  - createdAt: timestamp (indexed)
  - updatedAt: timestamp
  - likes: number
  - isModerated: boolean
```

**[Todo 2 - COMPLETED]**
**[Todo 3 - IN PROGRESS]** Dise√±ando security rules...

> Use the firebase-architect agent to design Firestore security rules for the comments system

[Agent dise√±a rules]

```javascript
match /comments/{commentId} {
  allow read: if true; // Public read
  allow create: if request.auth != null
                && request.resource.data.userId == request.auth.uid
                && request.resource.data.text.size() > 0
                && request.resource.data.text.size() <= 500;
  allow update: if request.auth != null
                && resource.data.userId == request.auth.uid
                && request.resource.data.userId == resource.data.userId; // Can't change author
  allow delete: if request.auth != null
                && (resource.data.userId == request.auth.uid || isAdmin());
}
```

**[Todo 3 - COMPLETED]**
**[Todos 4-9 - IN PROGRESS]** Implementando c√≥digo...

[Implemento todas las funciones y componentes]

**[Todos 4-9 - COMPLETED]**
**[Todo 10 - IN PROGRESS]** Creando tests unitarios...

> Use the test-writer agent to create comprehensive unit tests for:
> - Comment creation service
> - Comment update service
> - Comment deletion service
> - CommentList component
> - CommentForm component

[Agent crea tests]

**[Todo 10 - COMPLETED]**
**[Todo 11 - IN PROGRESS]** Creando tests de integraci√≥n...

> Use the test-writer agent to create integration tests for the complete comment flow using Firebase emulators

[Agent crea integration tests]

**[Todo 11 - COMPLETED]**
**[Todo 12 - IN PROGRESS]** Revisando c√≥digo...

> Use the code-reviewer agent to review the complete comments implementation focusing on:
> - Code quality and maintainability
> - Firebase best practices
> - Performance optimization
> - Error handling

[Agent revisa y proporciona feedback]

Feedback recibido:
üî¥ Critical: Falta validaci√≥n de longitud en Cloud Function
üü° Warning: Considera agregar rate limiting
üîµ Suggestion: Usar batch para likes

Aplicando correcciones...

**[Todo 12 - COMPLETED]**
**[Todo 13 - IN PROGRESS]** Auditando seguridad...

> Use the security-auditor agent to perform security audit on the comments system

[Agent audita seguridad]

Audit findings:
‚úÖ Security rules are properly configured
‚úÖ Input validation implemented
‚úÖ No XSS vulnerabilities
‚ö†Ô∏è  Recommendation: Add rate limiting for comment creation

Implementando rate limiting...

**[Todo 13 - COMPLETED]**
**[Todo 14 - IN PROGRESS]** Creando test plan...

> Use the qa-specialist agent to create a comprehensive test plan for the comments feature

[Agent crea test plan detallado]

**[Todo 14 - COMPLETED]**
**[Todo 15 - IN PROGRESS]** Documentando API...

> Use the documentation-writer agent to create documentation for the comments API

[Agent crea documentaci√≥n]

**[Todo 15 - COMPLETED]**
**[Todo 16 - IN PROGRESS]** Desplegando a staging...

> /deploy-staging

[Deploy se ejecuta con todos los checks]

Deploy exitoso! URL: https://staging.myapp.com

**[Todo 16 - COMPLETED]**
**[Todo 17 - IN PROGRESS]** Testing en staging...

> Use the qa-specialist agent to verify the test plan in staging environment

Testeando:
‚úÖ Crear comentario
‚úÖ Editar comentario
‚úÖ Eliminar comentario
‚úÖ Real-time updates
‚úÖ Paginaci√≥n
‚úÖ Moderaci√≥n
‚úÖ Permisos

**[Todo 17 - COMPLETED]**
**[Todo 18 - IN PROGRESS]** Desplegando a producci√≥n...

> /deploy-production

[Deploy a producci√≥n con confirmaci√≥n]

‚úÖ Deployed to production!

Monitoreando logs...
‚úÖ No errors en primeros 15 minutos
‚úÖ Analytics normal
‚úÖ Comments funcionando correctamente

**[Todo 18 - COMPLETED]**

---

## ‚úÖ FEATURE COMPLETADA (18/18)

**Resumen:**
- ‚úÖ Sistema de comentarios implementado
- ‚úÖ Real-time updates funcionando
- ‚úÖ Seguridad auditada y aprobada
- ‚úÖ Tests creados (90% coverage)
- ‚úÖ Documentaci√≥n completa
- ‚úÖ Desplegado a producci√≥n

**Archivos modificados:**
- `src/components/CommentList.tsx`
- `src/components/CommentForm.tsx`
- `src/services/comments.ts`
- `functions/src/comments.ts`
- `firestore.rules`
- `tests/comments.test.ts`
- `docs/API.md`

**Pr√≥ximos pasos sugeridos:**
- Monitorear analytics por 48 horas
- Considerar agregar threading a comentarios
- Implementar notificaciones de nuevos comentarios
```

---

Este es exactamente c√≥mo yo trabajar√≠a esta feature completa, usando todos los agentes disponibles y manteniendo el TodoWrite actualizado en cada paso.

## üéì Lecciones Aprendidas (Mejores Pr√°cticas)

### ‚úÖ SIEMPRE:

1. **Crear TodoWrite antes de empezar**
2. **Usar agentes especializados para cada fase**
3. **Marcar todos como completed inmediatamente**
4. **Hacer security audit antes de producci√≥n**
5. **Testear en staging antes de producci√≥n**
6. **Desplegar gradualmente (staging ‚Üí prod)**
7. **Monitorear despu√©s de cada deploy**

### ‚ùå NUNCA:

1. **Empezar a codificar sin TodoWrite**
2. **Saltarse el code-reviewer**
3. **Deploy a producci√≥n sin staging**
4. **Ignorar warnings del security-auditor**
5. **Deploy de pagos sin /test-payment-flow**
6. **Commitear sin revisar cambios**
7. **Deploy sin tests pasando**

### üéØ REGLAS ESPECIALES:

#### Para Pagos:
- ‚úÖ DOBLE revisi√≥n (code-reviewer + security-auditor)
- ‚úÖ TRIPLE testing (unit + integration + /test-payment-flow)
- ‚úÖ Deploy a staging m√≠nimo 48h antes de producci√≥n
- ‚úÖ Monitoring intensivo post-deploy

#### Para Security Rules:
- ‚úÖ Dise√±ar con firebase-architect
- ‚úÖ Revisar con security-auditor
- ‚úÖ Testear en emulators antes de deploy
- ‚úÖ Deploy solo security rules primero, luego c√≥digo

#### Para Cloud Functions:
- ‚úÖ Dise√±ar con cloud-functions-specialist
- ‚úÖ Tests exhaustivos (test-writer)
- ‚úÖ Revisar performance y cold starts
- ‚úÖ Monitorear invocations post-deploy

## üîÑ Ciclo de Feedback Continuo

Despu√©s de cada feature:

```markdown
**TodoWrite - Post-Feature Review:**
1. ‚è≥ Revisar qu√© funcion√≥ bien
2. ‚è≥ Identificar qu√© se puede mejorar
3. ‚è≥ Actualizar documentaci√≥n si es necesario
4. ‚è≥ Compartir aprendizajes con el equipo
```

---

**Resumen:** Esta gu√≠a es mi "libro de jugadas" para trabajar de forma √≥ptima con este proyecto. TodoWrite es el n√∫cleo que mantiene todo organizado, y los agentes especializados son las herramientas que uso en cada fase para garantizar calidad m√°xima.
